#!/bin/sh
while true
do
    NOTIFICATION=`inotifywait -q ~/irc -r -e OPEN`
    FILE=`echo "$NOTIFICATION" | cut -f3 -d ' '`
    DIRECTORY=`echo "$NOTIFICATION" | cut -f1 -d ' '`
    test "$FILE" = "out" && (
        SERVER=`echo "$DIRECTORY" | cut -f5 -d '/'`
        ENTITY=`echo "$DIRECTORY" | cut -f6 -d '/'`
        MESSAGE=`tail -n1 "$DIRECTORY/$FILE" | cut -f3- -d ' '`
        pgrep -f "./uii $SERVER $ENTITY" || \
            notify-send -t 0 -i network-receive "$ENTITY ($SERVER)" "<i>$MESSAGE</i>"
    )
done
