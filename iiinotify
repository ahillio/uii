#!/bin/sh
FORBIDDEN=`busybox printf "\001-\011\013-\037"`
while true
do
    NOTIFICATION=`inotifywait -q ~/irc -r -e OPEN | \
        busybox tr -d "$FORBIDDEN"`
    FILE=`echo "$NOTIFICATION" | cut -f3 -d ' '`
    DIRECTORY=`echo "$NOTIFICATION" | cut -f1 -d ' '`
    test "$FILE" = "out" && (
        SERVER=`echo "$DIRECTORY" | cut -f5 -d '/'`
        ENTITY=`echo "$DIRECTORY" | cut -f6 -d '/'`
        MESSAGE=`tail -n1 "$DIRECTORY/$FILE" | cut -f3- -d ' ' | \
            busybox tr -d "$FORBIDDEN"`
        pgrep -f "./uii $SERVER $ENTITY" || \
            notify-send -t 0 -i network-receive "$ENTITY @ $SERVER" "$MESSAGE"
    )
done
